#! /bin/sh

init_mezzanine() (
    buildID="$1";
    testbeds="$2";
    if [ "x$buildID" = "x" ] || [ "x$testbeds" = "x" ]; then
        echo "Error: missing arguments"
        echo "Expected: \"buildID\" \"testbeds\""
        return 1
    fi
    cd "/builds/automated/$buildID/src/daemons/scqad/" &&
        "$(make -s echo_targetdir)/scqadleader" -s -b $testbeds 'installSCQADOnCluster {}; configureClusters {}'
    return $?
)

build_on_vm()
(
    CODE_DIR="$HOME/git/scale-product"
    rsync -avzh -e ssh --exclude-from='$HOME/.gitignore' --exclude-from='$CODE_DIR/.gitignore' $CODE_DIR/* buildvm:/local/scape-product && \
        ssh buildvm "./Scripts/build.sh && ./Scripts/build.sh unit"
)
